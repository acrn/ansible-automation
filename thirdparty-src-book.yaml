---
- hosts: devmachines

  vars:

    dest: "~/src/3rdparty/"

    repos:

      git:

        - allura:
          dest:       "allura"
          url:        "https://git-wip-us.apache.org/repos/asf/allura"

        - cassandra:
          dest:       "cassandra"
          url:        "http://git-wip-us.apache.org/repos/asf/cassandra.git"

        - clojure:
          dest:       "clojure"
          url:        "https://github.com/clojure/clojure.git"

        - crouton:
          dest:       "crouton"
          url:        "https://github.com/dnschneid/crouton.git"

        - go:
          dest:       "go"
          url:        "https://go.googlesource.com/go"

        - ipython:
          dest:       "ipython"
          url:        "https://github.com/ipython/ipython.git"

        - lodash:
          dest:       "lodash"
          url:        "https://github.com/lodash/lodash.git"

      mercurial:

        - cpython:
          dest:       "cpython"
          url:        "https://hg.python.org/cpython"

        - pypy:
          dest:       "pypy"
          url:        "https://bitbucket.org/pypy/pypy"

        - six:
          dest:       "six"
          url:        "https://bitbucket.org/gutworth/six"

      svn:

        - genshi:
          dest:       "genshi"
          url:        "http://svn.edgewall.org/repos/genshi"

        - trac:
          dest:       "trac"
          url:        "http://svn.edgewall.org/repos/trac"
    
  tasks:

# setup
  - file: path="{{dest}}" state=directory mode=0755

  - name: install versioning packages
    tags: vim
    dnf: name="{{item}}" state=latest
    become: yes
    with_items:
      - git
      - git-svn
      - mercurial

  - name:        git
    git:         repo="{{item.url}}" dest="{{dest}}{{item.dest}}"
    with_items:  "{{repos.git}}"

  - name:        hg
    hg:          repo="{{item.url}}" dest="{{dest}}{{item.dest}}"
    with_items:  "{{repos.mercurial}}"

  - name:        git svn clone
    command:     "git svn clone --stdlayout {{item.url}} {{item.dest}}"
    args:
      chdir:     "{{dest}}"
      creates:   "{{dest}}{{item.dest}}/.git"
    with_items:  "{{repos.svn}}"

  - name:        git svn fetch
    command:     "git svn fetch --all"
    args:
      chdir:     "{{dest}}{{item.dest}}"
    with_items:  "{{repos.svn}}"

  - name:        git svn rebase
    command:     "git svn rebase"
    args:
      chdir:     "{{dest}}{{item.dest}}"
    with_items:  "{{repos.svn}}"
